bits 64 ; target processor mode

; import fucntion 
extern puts
extern fgets
extern stdin
extern strlen
extern printf

section .text	; text section containing code
global print_reverse
print_reverse:
	push rbp
	mov rbp, rsp
	
	mov r12, rdi	; buffer
	mov r13, rsi	; size
	mov rbx, r13
	dec rbx
	; push 0x00006325		; '%c'
	jmp check
doing:
	; mov rdi, rsp
	mov rdi, char_fmt
	movzx rsi, byte[r12 + rbx]
	; mov rsi, 0x32
	call printf
	dec rbx
check:
	test rbx, rbx
	jns doing

	mov rdi, newline
	call printf
	leave
	ret
global main	; int main ... (not static or private in OOP)
main:
	push rbp
	mov rbp, rsp
	sub rsp, 0x200
	mov rdi, welcome
	call puts
	lea rbx, [rbp - 0x100]	
	mov rdi, rbx
	mov rsi, 0x100
	mov rdx, qword[stdin]
	call fgets		; fgets
	mov rdi, rbx
	call strlen		; strlen
	cdq 		; sign-extend
	mov r8, rax
	movzx ecx, byte[rbx + rax - 1]
	cmp ecx, 0xA
	jne ignore
	mov byte[rbx + rax - 1], 0
ignore:
	mov rdi, rbx	
	mov rsi, r8
	dec rsi
	call print_reverse
	leave
	ret

section .rodata
welcome: db "--- asm #6 ---",0
char_fmt: db "%c", 0
newline: db 0xA, 0
